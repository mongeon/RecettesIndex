@using MudBlazor
@using RecettesIndex.Models
@using RecettesIndex.Services
@using RecettesIndex.Components

<MudGrid Spacing="3" Class="mt-4">
    @{
        int cardIndex = 0;
    }
    @foreach (var recipe in Recipes)
    {
        var book = Books.FirstOrDefault(b => b.Id == recipe.BookId);
        var store = Stores.FirstOrDefault(s => s.Id == recipe.StoreId);
        var delay = cardIndex * 45;
        cardIndex++;
        <MudItem xs="12" sm="6" md="4" lg="3" Style="@($"animation: fadeInUp 0.35s ease-out both; animation-delay: {delay}ms;")">
            <RecipeCard Recipe="@recipe"
                       Book="@book"
                       Store="@store"
                       IsAuthenticated="@IsAuthenticated"
                       IsFavorite="@FavoriteRecipeIds.Contains(recipe.Id)"
                       OnView="OnViewRecipe"
                       OnEdit="OnEditRecipe"
                       OnDelete="OnDeleteRecipe"
                       OnPrint="OnPrintRecipe"
                       OnToggleFavorite="OnToggleFavorite" />
        </MudItem>
    }
</MudGrid>

<!-- Pagination -->
<div class="d-flex flex-column align-center mt-4">
    <MudPagination Count="@TotalPages"
                  SelectedChanged="OnPageChanged"
                  Selected="@CurrentPage"
                  Color="Color.Primary"
                  ShowFirstButton="true"
                  ShowLastButton="true" />
    @if (TotalPages > 1 || TotalCount > 0)
    {
        <div class="pagination-info">
            Page @CurrentPage sur @TotalPages
            @if (TotalCount > 0)
            {
                <span> Â· @TotalCount recette@(TotalCount > 1 ? "s" : "")</span>
            }
        </div>
    }
</div>

@code {
    [Parameter, EditorRequired] public List<Recipe> Recipes { get; set; } = new();
    [Parameter, EditorRequired] public List<Book> Books { get; set; } = new();
    [Parameter, EditorRequired] public List<Store> Stores { get; set; } = new();
    [Parameter, EditorRequired] public List<int> FavoriteRecipeIds { get; set; } = new();
    [Parameter, EditorRequired] public bool IsAuthenticated { get; set; }
    [Parameter, EditorRequired] public int CurrentPage { get; set; }
    [Parameter, EditorRequired] public int TotalPages { get; set; }
    [Parameter] public int TotalCount { get; set; }

    [Parameter, EditorRequired] public EventCallback<Recipe> OnViewRecipe { get; set; }
    [Parameter, EditorRequired] public EventCallback<Recipe> OnEditRecipe { get; set; }
    [Parameter, EditorRequired] public EventCallback<Recipe> OnDeleteRecipe { get; set; }
    [Parameter, EditorRequired] public EventCallback<Recipe> OnPrintRecipe { get; set; }
    [Parameter, EditorRequired] public EventCallback<Recipe> OnToggleFavorite { get; set; }
    [Parameter, EditorRequired] public EventCallback<int> OnPageChanged { get; set; }
}
