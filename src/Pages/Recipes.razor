@page "/recipes"
@using Microsoft.Extensions.Logging
@using MudBlazor
@using RecettesIndex.Models
@using RecettesIndex.Services
@using RecettesIndex.Services.Abstractions
@using RecettesIndex.Components
@using Microsoft.JSInterop
@inject AuthService AuthService
@inject IDialogService DialogService
@inject IJSRuntime JSRuntime
@inject ILogger<Recipes> Logger
@inject IRecipeService RecipeService
@inject ISnackbar Snackbar
@inject NavigationManager NavigationManager
@inject LocalStorageService LocalStorage

<PageTitle>Recettes</PageTitle>

<MudPaper Class="pa-4">
    <MudStack Row Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center" Class="mb-4">
        <div>
            <MudText Typo="Typo.h5">Recettes</MudText>
            <MudBreadcrumbs Items="breadcrumbs" Class="mt-2" />
        </div>
        
        <!-- View Toggle Button -->
        <MudTooltip Text="@(isCardView ? "Passer en vue liste" : "Passer en vue grille")">
            <MudToggleIconButton @bind-Toggled="isCardView"
                                Icon="@Icons.Material.Filled.ViewList"
                                ToggledIcon="@Icons.Material.Filled.ViewModule"
                                Color="Color.Primary"
                                Size="Size.Large" />
        </MudTooltip>
    </MudStack>
    
    <!-- Quick Filter Buttons -->
    <RecipeQuickFilters ShowAllRecipes="@showAllRecipes"
                       QuickFilterRating="@quickFilterRating"
                       QuickFilterUnrated="@quickFilterUnrated"
                       ShowRecentRecipes="@showRecentRecipes"
                       ShowFavorites="@showFavorites"
                       HasActiveFilters="@HasActiveFilters()"
                       TotalCount="@totalCount"
                       FiveStarCount="@fiveStarCount"
                       FourPlusStarCount="@fourPlusStarCount"
                       UnratedCount="@unratedCount"
                       FavoritesCount="@favoritesCount"
                       OnShowAll="ShowAll"
                       OnApplyQuickFilter="ApplyQuickFilter"
                       OnShowUnrated="ShowUnrated"
                       OnShowFavorites="ShowFavorites"
                       OnShowRecent="ShowRecent"
                       OnShowRandom="ShowRandom"
                       OnClearAllFilters="ClearAllFilters" />
    
    <!-- Collapsible Advanced Filters -->
    <RecipeAdvancedFilters SearchTerm="@searchTerm"
                          RatingFilter="@ratingFilter"
                          BookFilter="@bookFilter"
                          AuthorFilter="@authorFilter"
                          ActiveFilterCount="@GetActiveFilterCount()"
                          Books="@books"
                          Authors="@authors"
                          BookRecipeCounts="@bookRecipeCounts"
                          AuthorRecipeCounts="@authorRecipeCounts"
                          OnSearchChanged="OnSearchChanged"
                          OnRatingChanged="OnRatingChanged"
                          OnBookChanged="OnBookChanged"
                          OnAuthorChanged="OnAuthorChanged"
                          OnClearAllFilters="ClearAllFilters" />

    <!-- Active Filters Display -->
    <RecipeActiveFilters HasActiveFilters="@HasActiveFilters()"
                        SearchTerm="@searchTerm"
                        RatingFilter="@ratingFilter"
                        BookFilter="@bookFilter"
                        AuthorFilter="@authorFilter"
                        Books="@books"
                        Authors="@authors"
                        OnClearSearch="ClearSearch"
                        OnClearRating="ClearRating"
                        OnClearBook="ClearBook"
                        OnClearAuthor="ClearAuthor" />

    <!-- Loading State -->
    @if (isLoading)
    {
        <RecipeLoadingState IsCardView="@isCardView" SkeletonCount="8" />
    }
    else if (currentRecipes.Count == 0)
    {
        <!-- Empty State -->
        <EmptyState Icon="@Icons.Material.Filled.RestaurantMenu"
                    IconColor="Color.Secondary"
                    Title="@GetEmptyStateTitle()"
                    Message="@GetEmptyStateMessage()"
                    ShowAction="@(!HasActiveFilters())"
                    ActionText="Ajouter une recette"
                    ActionIcon="@Icons.Material.Filled.Add"
                    OnActionClick="ShowAddDialog"
                    SecondaryActionText="@(HasActiveFilters() ? "R√©initialiser les filtres" : null)"
                    OnSecondaryActionClick="ClearAllFilters" />
    }
    else
    {
        <!-- Card View -->
        @if (isCardView)
        {
            <RecipeGridView Recipes="@currentRecipes"
                           Books="@books"
                           FavoriteRecipeIds="@favoriteRecipeIds"
                           IsAuthenticated="@AuthService.IsAuthenticated"
                           CurrentPage="@currentPage"
                           TotalPages="@totalPages"
                           OnViewRecipe="ViewRecipe"
                           OnEditRecipe="ShowEditDialog"
                           OnDeleteRecipe="DeleteRecipe"
                           OnPrintRecipe="PrintRecipe"
                           OnToggleFavorite="ToggleFavorite"
                           OnPageChanged="OnPageChanged" />
        }
        else
        {
            <!-- Table View -->
            <RecipeTableView Books="@books"
                            IsAuthenticated="@AuthService.IsAuthenticated"
                            LoadServerData="LoadServerData"
                            OnEditRecipe="ShowEditDialog"
                            OnDeleteRecipe="DeleteRecipe"
                            @ref="tableViewRef" />
        }
    }
    
    @if (AuthService.IsAuthenticated)
    {
        <MudButton Variant="Variant.Filled" Color="Color.Primary" Class="mt-2" OnClick="ShowAddDialog">Ajouter une recette</MudButton>
    }
</MudPaper>

@code {
    private RecipeTableView? tableViewRef;
    private List<Book> books = [];
    private List<Author> authors = [];
    private List<BreadcrumbItem> breadcrumbs =>
    [
        new BreadcrumbItem("Accueil", href: ""),
        new BreadcrumbItem("Recettes", href: "/recipes", disabled: true)
    ];
    
    // Filter state
    private string searchTerm = string.Empty;
    private string? ratingFilter;
    private string? bookFilter;
    private string? authorFilter;
    
    // Quick filter state
    private bool showAllRecipes = true;
    private int? quickFilterRating = null;
    private bool quickFilterUnrated = false;
    private bool showRecentRecipes = false;
    private bool showFavorites = false;
    private List<int> favoriteRecipeIds = new();
    
    // Filter counts
    private int totalCount = 0;
    private int fiveStarCount = 0;
    private int fourPlusStarCount = 0;
    private int unratedCount = 0;
    private int favoritesCount = 0;
    private Dictionary<int, int> bookRecipeCounts = new();
    private Dictionary<int, int> authorRecipeCounts = new();
    
    // Memoized active filter count
    private int? _cachedActiveFilterCount = null;
    
    // View state
    private bool _isCardView = false;
    private bool isCardView 
    { 
        get => _isCardView;
        set
        {
            if (_isCardView != value)
            {
                _isCardView = value;
                _ = OnViewModeChanged();
            }
        }
    }
    
    private bool isLoading = true;
    private List<Recipe> currentRecipes = new();
    private int currentPage = 1;
    private int pageSize = 12;
    private int totalPages = 0;
    private const string ViewModeKey = "recipeViewMode";

    protected override async Task OnInitializedAsync()
    {
        try
        {
            await LoadViewPreference();
            isLoading = true;
            await LoadRecipes();
            await LoadFilterCounts();
            await ReadQueryParameters();
            
            if (isCardView)
            {
                await LoadCardViewData();
            }
            else
            {
                isLoading = false;
            }
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "Error initializing Recipes page");
            isLoading = false;
            StateHasChanged();
        }
    }
    
    protected override async Task OnParametersSetAsync()
    {
        await ReadQueryParameters();
    }
    
    #region Initialization Methods
    
    private async Task LoadViewPreference()
    {
        try
        {
            var viewMode = await JSRuntime.InvokeAsync<string>("localStorage.getItem", ViewModeKey);
            _isCardView = viewMode == "card";
        }
        catch
        {
            _isCardView = false;
        }
    }
    
    private async Task SaveViewPreference()
    {
        try
        {
            await JSRuntime.InvokeVoidAsync("localStorage.setItem", ViewModeKey, isCardView ? "card" : "table");
        }
        catch (Exception ex)
        {
            Logger.LogWarning(ex, "Failed to save view preference to localStorage");
        }
    }
    
    private async Task ReadQueryParameters()
    {
        var uri = NavigationManager.ToAbsoluteUri(NavigationManager.Uri);
        var query = System.Web.HttpUtility.ParseQueryString(uri.Query);
        
        var bookIdParam = query["bookId"];
        if (!string.IsNullOrEmpty(bookIdParam) && int.TryParse(bookIdParam, out var bookId))
        {
            bookFilter = bookId.ToString();
            showAllRecipes = false;
            
            if (books.Any())
            {
                if (isCardView)
                    await LoadCardViewData();
                else
                    await Reload();
            }
        }
    }
    
    private async Task LoadRecipes()
    {
        books = (await RecipeService.GetBooksAsync())?.ToList() ?? new();
        authors = (await RecipeService.GetAuthorsAsync())?.ToList() ?? new();
    }

    private async Task LoadFilterCounts()
    {
        favoriteRecipeIds = await LocalStorage.GetFavoritesAsync();
        
        var result = await RecipeService.SearchAsync(null, null, null, null, null, 1, 10000);
        if (result.IsSuccess)
        {
            var allRecipes = result.Value.Items;
            totalCount = allRecipes.Count;
            fiveStarCount = allRecipes.Count(r => r.Rating == 5);
            fourPlusStarCount = allRecipes.Count(r => r.Rating >= 4);
            unratedCount = allRecipes.Count(r => r.Rating == 0 || r.Rating < 1);
            favoritesCount = favoriteRecipeIds.Count;
            
            bookRecipeCounts = allRecipes
                .Where(r => r.BookId.HasValue)
                .GroupBy(r => r.BookId!.Value)
                .ToDictionary(g => g.Key, g => g.Count());
            
            authorRecipeCounts = new Dictionary<int, int>();
            foreach (var author in authors)
            {
                var authorBookIds = books.Where(b => b.Authors.Any(a => a.Id == author.Id)).Select(b => b.Id).ToHashSet();
                var count = allRecipes.Count(r => r.BookId.HasValue && authorBookIds.Contains(r.BookId.Value));
                authorRecipeCounts[author.Id] = count;
            }
        }
    }
    
    #endregion
    
    #region Data Loading Methods
    
    private async Task OnViewModeChanged()
    {
        await SaveViewPreference();
        
        if (isCardView)
        {
            currentPage = 1;
            await LoadCardViewData();
        }
        else
        {
            await Reload();
        }
    }
    
    private async Task LoadCardViewData()
    {
        isLoading = true;
        try
        {
            int? rating = GetRatingFilter();
            int? bookId = GetBookIdFilter();
            int? authorId = GetAuthorIdFilter();
            
            var result = await RecipeService.SearchAsync(
                searchTerm, rating, bookId, null, authorId, currentPage, pageSize, "created_at", true);
            
            if (result.IsSuccess)
            {
                var items = result.Value.Items.ToList();
                var total = result.Value.Total;
                
                if (showRecentRecipes)
                {
                    var thirtyDaysAgo = DateTime.UtcNow.AddDays(-30);
                    items = items.Where(r => r.CreationDate >= thirtyDaysAgo).ToList();
                    total = items.Count;
                }
                
                if (showFavorites)
                {
                    items = items.Where(r => favoriteRecipeIds.Contains(r.Id)).ToList();
                    total = items.Count;
                }
                
                currentRecipes = items;
                totalPages = (int)Math.Ceiling(total / (double)pageSize);
            }
            else
            {
                currentRecipes = [];
                totalPages = 0;
            }
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "Error loading card view data");
            currentRecipes = [];
            totalPages = 0;
        }
        finally
        {
            isLoading = false;
            StateHasChanged();
        }
    }
    
    private async Task<TableData<Recipe>> LoadServerData(TableState state, CancellationToken token)
    {
        var page = state.Page + 1;
        var pageSize = state.PageSize;
        
        int? rating = null;
        if (quickFilterUnrated)
        {
            // Handle unrated in post-processing
        }
        else if (quickFilterRating.HasValue)
        {
            if (quickFilterRating.Value == 4)
            {
                // Handle 4+ in post-processing
            }
            else
            {
                rating = quickFilterRating.Value;
            }
        }
        else if (ratingFilter != "all" && !string.IsNullOrWhiteSpace(ratingFilter))
        {
            rating = int.TryParse(ratingFilter, out var r) ? r : null;
        }
        
        int? bookId = GetBookIdFilter();
        int? authorId = GetAuthorIdFilter();
        
        var sortLabel = state.SortLabel;
        var sortDescending = state.SortDirection == SortDirection.Descending;
        
        var result = await RecipeService.SearchAsync(searchTerm, rating, bookId, null, authorId, page, pageSize, sortLabel, sortDescending);
        if (!result.IsSuccess)
            return new TableData<Recipe> { Items = Array.Empty<Recipe>(), TotalItems = 0 };
        
        var items = result.Value.Items;
        var total = result.Value.Total;
        
        if (quickFilterUnrated)
        {
            items = items.Where(r => r.Rating == 0 || r.Rating < 1).ToList();
            total = items.Count;
        }
        else if (quickFilterRating == 4)
        {
            items = items.Where(r => r.Rating >= 4).ToList();
            total = items.Count;
        }
        
        if (showRecentRecipes)
        {
            var thirtyDaysAgo = DateTime.UtcNow.AddDays(-30);
            items = items.Where(r => r.CreationDate >= thirtyDaysAgo).ToList();
            total = items.Count;
        }
        
        if (showFavorites)
        {
            items = items.Where(r => favoriteRecipeIds.Contains(r.Id)).ToList();
            total = items.Count;
        }
        
        return new TableData<Recipe> { Items = items, TotalItems = total };
    }
    
    private async Task Reload()
    {
        if (tableViewRef is not null)
        {
            await tableViewRef.ReloadServerData();
        }
    }
    
    #endregion
    
    #region Filter Methods
    
    private int GetActiveFilterCount()
    {
        if (_cachedActiveFilterCount.HasValue)
            return _cachedActiveFilterCount.Value;
        
        int count = 0;
        if (!string.IsNullOrWhiteSpace(searchTerm)) count++;
        if (ratingFilter != null && ratingFilter != "all") count++;
        if (bookFilter != null && bookFilter != "all") count++;
        if (authorFilter != null && authorFilter != "all") count++;
        
        _cachedActiveFilterCount = count;
        return count;
    }
    
    private void InvalidateFilterCountCache() => _cachedActiveFilterCount = null;
    
    private bool HasActiveFilters()
    {
        return !string.IsNullOrWhiteSpace(searchTerm) 
            || (ratingFilter != null && ratingFilter != "all") 
            || (bookFilter != null && bookFilter != "all") 
            || (authorFilter != null && authorFilter != "all");
    }
    
    private int? GetRatingFilter()
    {
        if (quickFilterUnrated)
            return null;
        if (quickFilterRating.HasValue && quickFilterRating.Value != 4)
            return quickFilterRating.Value;
        if (ratingFilter != "all" && !string.IsNullOrWhiteSpace(ratingFilter))
            return int.TryParse(ratingFilter, out var r) ? r : null;
        return null;
    }
    
    private int? GetBookIdFilter()
    {
        return (bookFilter == "all" || string.IsNullOrWhiteSpace(bookFilter)) 
            ? null 
            : (int.TryParse(bookFilter, out var b) ? b : null);
    }
    
    private int? GetAuthorIdFilter()
    {
        return (authorFilter == "all" || string.IsNullOrWhiteSpace(authorFilter)) 
            ? null 
            : (int.TryParse(authorFilter, out var a) ? a : null);
    }
    
    #endregion
    
    #region Quick Filter Event Handlers
    
    private async Task ShowAll()
    {
        showAllRecipes = true;
        showRecentRecipes = false;
        quickFilterRating = null;
        quickFilterUnrated = false;
        ratingFilter = null;
        currentPage = 1;
        
        if (isCardView)
            await LoadCardViewData();
        else
            await Reload();
    }

    private async Task ApplyQuickFilter(int rating)
    {
        showAllRecipes = false;
        showRecentRecipes = false;
        quickFilterRating = rating;
        quickFilterUnrated = false;
        ratingFilter = rating >= 4 ? null : rating.ToString();
        currentPage = 1;
        
        if (isCardView)
            await LoadCardViewData();
        else
            await Reload();
    }

    private async Task ShowUnrated()
    {
        showAllRecipes = false;
        showRecentRecipes = false;
        quickFilterRating = null;
        quickFilterUnrated = true;
        ratingFilter = null;
        currentPage = 1;
        
        if (isCardView)
            await LoadCardViewData();
        else
            await Reload();
    }

    private async Task ShowFavorites()
    {
        if (showFavorites)
        {
            showFavorites = false;
            showAllRecipes = true;
        }
        else
        {
            showAllRecipes = false;
            showRecentRecipes = false;
            quickFilterRating = null;
            quickFilterUnrated = false;
            showFavorites = true;
            ratingFilter = null;
            bookFilter = null;
            authorFilter = null;
            searchTerm = string.Empty;
        }
        
        currentPage = 1;
        
        if (isCardView)
            await LoadCardViewData();
        else
            await Reload();
    }
    
    private async Task ShowRecent()
    {
        showAllRecipes = false;
        showRecentRecipes = true;
        quickFilterRating = null;
        quickFilterUnrated = false;
        ratingFilter = null;
        bookFilter = null;
        authorFilter = null;
        searchTerm = string.Empty;
        currentPage = 1;
        
        if (isCardView)
            await LoadCardViewData();
        else
            await Reload();
    }
    
    private async Task ShowRandom()
    {
        try
        {
            var countResult = await RecipeService.SearchAsync(null, null, null, null, null, 1, 1);
            if (!countResult.IsSuccess || countResult.Value.Total == 0)
            {
                Snackbar.Add("Aucune recette disponible", Severity.Warning);
                return;
            }
            
            var random = new Random();
            var randomIndex = random.Next(0, countResult.Value.Total);
            var randomPage = (randomIndex / 1) + 1;
            
            var result = await RecipeService.SearchAsync(null, null, null, null, null, randomPage, 1);
            if (result.IsSuccess && result.Value.Items.Any())
            {
                var randomRecipe = result.Value.Items.First();
                NavigationManager.NavigateTo($"/recipes/{randomRecipe.Id}");
                Snackbar.Add($"üé≤ Surprise: {randomRecipe.Name}!", Severity.Info);
            }
            else
            {
                Snackbar.Add("Aucune recette disponible", Severity.Warning);
            }
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "Error selecting random recipe");
            Snackbar.Add("Erreur lors de la s√©lection al√©atoire", Severity.Error);
        }
    }

    private async Task ClearAllFilters()
    {
        searchTerm = string.Empty;
        ratingFilter = null;
        bookFilter = null;
        authorFilter = null;
        showAllRecipes = true;
        showRecentRecipes = false;
        quickFilterRating = null;
        quickFilterUnrated = false;
        currentPage = 1;
        showFavorites = false;
        InvalidateFilterCountCache();
        
        if (isCardView)
            await LoadCardViewData();
        else
            await Reload();
    }
    
    #endregion
    
    #region Clear Individual Filter Methods
    
    private async Task ClearSearch()
    {
        searchTerm = string.Empty;
        currentPage = 1;
        InvalidateFilterCountCache();
        
        if (isCardView)
            await LoadCardViewData();
        else
            await Reload();
    }

    private async Task ClearRating()
    {
        ratingFilter = null;
        quickFilterRating = null;
        quickFilterUnrated = false;
        showAllRecipes = true;
        showRecentRecipes = false;
        currentPage = 1;
        InvalidateFilterCountCache();
        
        if (isCardView)
            await LoadCardViewData();
        else
            await Reload();
    }

    private async Task ClearBook()
    {
        bookFilter = null;
        currentPage = 1;
        InvalidateFilterCountCache();
        
        if (isCardView)
            await LoadCardViewData();
        else
            await Reload();
    }

    private async Task ClearAuthor()
    {
        authorFilter = null;
        currentPage = 1;
        InvalidateFilterCountCache();
        
        if (isCardView)
            await LoadCardViewData();
        else
            await Reload();
    }
    
    #endregion
    
    #region Filter Changed Event Handlers
    
    private async Task OnRatingChanged(string? value)
    {
        ratingFilter = value;
        showAllRecipes = false;
        quickFilterRating = null;
        quickFilterUnrated = false;
        currentPage = 1;
        InvalidateFilterCountCache();
        
        if (isCardView)
            await LoadCardViewData();
        else
            await Reload();
    }

    private async Task OnBookChanged(string? value)
    {
        bookFilter = value;
        currentPage = 1;
        InvalidateFilterCountCache();
        
        if (isCardView)
            await LoadCardViewData();
        else
            await Reload();
    }

    private async Task OnAuthorChanged(string? value)
    {
        authorFilter = value;
        currentPage = 1;
        InvalidateFilterCountCache();
        
        if (isCardView)
            await LoadCardViewData();
        else
            await Reload();
    }

    private async Task OnSearchChanged(string value)
    {
        searchTerm = value;
        currentPage = 1;
        InvalidateFilterCountCache();
        
        if (isCardView)
            await LoadCardViewData();
        else
            await Reload();
    }
    
    private async Task OnPageChanged(int page)
    {
        currentPage = page;
        await LoadCardViewData();
        StateHasChanged();
    }
    
    #endregion
    
    #region Recipe Action Methods
    
    private void ViewRecipe(Recipe recipe)
    {
        NavigationManager.NavigateTo($"/recipes/{recipe.Id}");
    }
    
    private void PrintRecipe(Recipe recipe)
    {
        NavigationManager.NavigateTo($"/recipes/{recipe.Id}/print");
    }
    
    private async Task ToggleFavorite(Recipe recipe)
    {
        await LocalStorage.ToggleFavoriteAsync(recipe.Id);
        
        favoriteRecipeIds = await LocalStorage.GetFavoritesAsync();
        favoritesCount = favoriteRecipeIds.Count;
        
        if (showFavorites)
        {
            if (isCardView)
                await LoadCardViewData();
            else
                await Reload();
        }
        
        StateHasChanged();
        
        var isFavorite = favoriteRecipeIds.Contains(recipe.Id);
        Snackbar.Add(
            isFavorite ? $"'{recipe.Name}' ajout√© aux favoris ‚ù§Ô∏è" : $"'{recipe.Name}' retir√© des favoris",
            isFavorite ? Severity.Success : Severity.Info
        );
    }

    private async Task ShowAddDialog()
    {
        var dialog = await DialogService.ShowAsync<AddRecipeDialog>("Ajouter une recette");
        var result = await dialog.Result;
        if (result is not null && !result.Canceled)
        {
            await LoadRecipes();
            await LoadFilterCounts();
            
            if (isCardView)
            {
                await LoadCardViewData();
            }
            
            Snackbar.Add("Recette ajout√©e avec succ√®s!", Severity.Success);
        }
    }

    private async Task ShowEditDialog(Recipe recipeToEdit)
    {
        var parameters = new MudBlazor.DialogParameters { ["RecipeToEdit"] = recipeToEdit };
        var dialog = await DialogService.ShowAsync<EditRecipeDialog>("Modifier la recette", parameters);
        var result = await dialog.Result;
        if (result is not null && !result.Canceled)
        {
            await LoadRecipes();
            await LoadFilterCounts();
            
            if (isCardView)
            {
                await LoadCardViewData();
            }
            
            Snackbar.Add("Recette modifi√©e avec succ√®s!", Severity.Success);
        }
    }

    private async Task DeleteRecipe(Recipe recipeToDelete)
    {
        try
        {
            bool? confirm = await DialogService.ShowMessageBox(
                "Confirmer la suppression",
                $"√ätes-vous s√ªr de vouloir supprimer la recette '{recipeToDelete.Name}' ? Cette action est irr√©versible.",
                yesText: "Supprimer",
                cancelText: "Annuler");

            if (confirm != true)
            {
                return;
            }

            var res = await RecipeService.DeleteAsync(recipeToDelete.Id);
            if (res.IsSuccess)
            {
                Snackbar.Add($"La recette '{recipeToDelete.Name}' a √©t√© supprim√©e avec succ√®s.", Severity.Success);
                
                if (isCardView)
                {
                    await LoadCardViewData();
                }
                else
                {
                    await Reload();
                }
                
                await LoadFilterCounts();
            }
            else
            {
                Snackbar.Add(res.ErrorMessage ?? "Une erreur s'est produite lors de la suppression de la recette.", Severity.Error);
            }
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "Error deleting recipe");
            Snackbar.Add("Une erreur s'est produite lors de la suppression de la recette. Veuillez r√©essayer.", Severity.Error);
        }
    }
    
    #endregion
    
    #region Helper Methods
    
    private string GetEmptyStateTitle()
    {
        if (HasActiveFilters())
            return "Aucune recette trouv√©e";
        return "Aucune recette pour le moment";
    }
    
    private string GetEmptyStateMessage()
    {
        if (HasActiveFilters())
            return "Essayez de modifier vos filtres ou r√©initialisez-les pour voir toutes les recettes.";
        return "Commencez par ajouter votre premi√®re recette pour construire votre collection personnelle.";
    }
    
    #endregion
}
